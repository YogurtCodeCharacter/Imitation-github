{"ast":null,"code":"const axios = require('axios');\n\nconst github_base_url = 'https://api.github.com';\n\nasync function requestGithub(method, url, data, headers) {\n  return await axios({\n    method,\n    url: `${github_base_url}${url}`,\n    data,\n    headers\n  });\n}\n\nconst isServer = true;\n\nasync function request({\n  method = 'GET',\n  url,\n  data = {}\n}, req, res) {\n  if (!url) {\n    throw Error('url must provide');\n  }\n\n  if (isServer) {\n    const session = req.session;\n    const githubAuth = session.githubAuth || {};\n    const headers = {};\n\n    if (githubAuth.access_token) {\n      headers['Authorization'] = `${githubAuth.token_type} ${githubAuth.access_token}`;\n    }\n\n    return await requestGithub(method, url, data, headers);\n  } else {\n    // /search/respos\n    return await axios({\n      method,\n      url: `/github${url}`,\n      data\n    });\n  }\n}\n\nmodule.exports = {\n  request,\n  requestGithub\n};","map":{"version":3,"sources":["/Users/zongliming/Desktop/Imitation-github/lib/api.js"],"names":["axios","require","github_base_url","requestGithub","method","url","data","headers","isServer","request","req","res","Error","session","githubAuth","access_token","token_type","module","exports"],"mappings":"AAAA,MAAMA,KAAK,GAAGC,OAAO,CAAC,OAAD,CAArB;;AAEA,MAAMC,eAAe,GAAG,wBAAxB;;AAEA,eAAeC,aAAf,CAA6BC,MAA7B,EAAqCC,GAArC,EAA0CC,IAA1C,EAAgDC,OAAhD,EAAyD;AACvD,SAAO,MAAMP,KAAK,CAAC;AACjBI,IAAAA,MADiB;AAEjBC,IAAAA,GAAG,EAAG,GAAEH,eAAgB,GAAEG,GAAI,EAFb;AAGjBC,IAAAA,IAHiB;AAIjBC,IAAAA;AAJiB,GAAD,CAAlB;AAMD;;AAED,MAAMC,QAAQ,OAAd;;AACA,eAAeC,OAAf,CAAuB;AAAEL,EAAAA,MAAM,GAAG,KAAX;AAAkBC,EAAAA,GAAlB;AAAuBC,EAAAA,IAAI,GAAG;AAA9B,CAAvB,EAA2DI,GAA3D,EAAgEC,GAAhE,EAAqE;AACnE,MAAI,CAACN,GAAL,EAAU;AACR,UAAMO,KAAK,CAAC,kBAAD,CAAX;AACD;;AACD,MAAIJ,QAAJ,EAAc;AACZ,UAAMK,OAAO,GAAGH,GAAG,CAACG,OAApB;AACA,UAAMC,UAAU,GAAGD,OAAO,CAACC,UAAR,IAAsB,EAAzC;AACA,UAAMP,OAAO,GAAG,EAAhB;;AACA,QAAIO,UAAU,CAACC,YAAf,EAA6B;AAC3BR,MAAAA,OAAO,CAAC,eAAD,CAAP,GAA4B,GAAEO,UAAU,CAACE,UAAW,IAClDF,UAAU,CAACC,YACZ,EAFD;AAGD;;AACD,WAAO,MAAMZ,aAAa,CAACC,MAAD,EAASC,GAAT,EAAcC,IAAd,EAAoBC,OAApB,CAA1B;AACD,GAVD,MAUO;AACL;AACA,WAAO,MAAMP,KAAK,CAAC;AACjBI,MAAAA,MADiB;AAEjBC,MAAAA,GAAG,EAAG,UAASA,GAAI,EAFF;AAGjBC,MAAAA;AAHiB,KAAD,CAAlB;AAKD;AACF;;AAEDW,MAAM,CAACC,OAAP,GAAiB;AACfT,EAAAA,OADe;AAEfN,EAAAA;AAFe,CAAjB","sourcesContent":["const axios = require('axios')\n\nconst github_base_url = 'https://api.github.com'\n\nasync function requestGithub(method, url, data, headers) {\n  return await axios({\n    method,\n    url: `${github_base_url}${url}`,\n    data,\n    headers,\n  })\n}\n\nconst isServer = typeof window === 'undefined'\nasync function request({ method = 'GET', url, data = {} }, req, res) {\n  if (!url) {\n    throw Error('url must provide')\n  }\n  if (isServer) {\n    const session = req.session\n    const githubAuth = session.githubAuth || {}\n    const headers = {}\n    if (githubAuth.access_token) {\n      headers['Authorization'] = `${githubAuth.token_type} ${\n        githubAuth.access_token\n      }`\n    }\n    return await requestGithub(method, url, data, headers)\n  } else {\n    // /search/respos\n    return await axios({\n      method,\n      url: `/github${url}`,\n      data,\n    })\n  }\n}\n\nmodule.exports = {\n  request,\n  requestGithub,\n}"]},"metadata":{},"sourceType":"script"}